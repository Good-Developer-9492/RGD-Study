# 7장 대역

## 대역의 필요성

테스트 대상이 외부 요인에 의존하면 테스트를 작성하고 실행하기 어려워진다.

테스트 대상에서 의존하는 요인 때문에 테ㅡ트가 어려울 때는 대역을 써서 테스트를 진행할 수 있다.

Double  
test Double은 테스트에서 진짜 대신 사용할 대역을 의미한다.  
대역의 종류는 Stub, Fake, Spy, Mock 이 존재하는데, 각 대역 종류마다 쓰임새가 다르다.

## 대역을 이용한 테스트

메모리에만 데이터가 저장되므로 DB와 같은 영속성을 제공하지는 않지만,  
테스트에 사용할 수 있을 만큼의 기능은 제공한다.

## 대역을 사용한 외부 상황 흉내와 결과 검증

대역을 이용해서 외부의 상황을 흉내 낸다.

대역을 이용하면 외부에 대한 결과를 검증할 수 있다.

## 대역의 종류

대역의 종류
* Stub (스텁)
  * 구현을 단순한 것으로 대체한다.
  * 테스트에 맞게 단순히 원하는 동작을 수행한다.
* Fake (가짜)
  * 제품에는 적합하지 않지만, 실제 동작하는 구현을 제공한다.
  * DB 대신에 메모리를 이용한다.
* Spy (스파이)
  * 호출된 내역을 기록한다.
  * 기록한 내용은 테스트 결과를 검증할 때 사용한다.
  * Stub이기도 하다
* Mock (모의)
  * 기대한 대로 상호작용하는지 행위를 검증한다.
  * 기대한 대로 동작하지 않으면 Exception을 발생할 수 있다.
  * 모의 객체는 Stub이자 Spy도 된다. 

## 상황과 결과 확인을 위한 협업 대상(의존) 도출과 대역 사용

제어하기 힘든 외부 상황이 존재하면 다음과 같은 방법으로 의존을 도출하고 이를 대역으로 대신할 수 있다.
* 제어하기 힘든 외부 상황을 별도 타입으로 분리
* 테스트 코드는 별도로 분리한 타입의 대역을 생성
* 생성한 대역을 테스트 대상의 생성자 등을 이용해서 전달
* 대역을 이용해서 상황 구성

## 대역과 개발 속도

대역을 사용하면 실제 구현이 없어도 다양한 상황에 대해 테스트할 수 있다.

대역을 사용하면 실제 구현이 없어도 실행 결과를 확인할 수 있다.

대역은 의존하는 대상을 구현하지 않아도 테스트 대상을 완성할 수 있게 만들어주며 이는 대기 시간을 줄여주어 개발 속도를 올리는 데 도움이 된다.

## 모의 객체를 과하게 사용하지 않기

모의 객체를 과하게 사용하면 오히려 테스트 코드가 복잡해지는 경우도 발생한다.

결과 값을 확인하는 수단으로 모의 객체를 사용하기 시작하면 결과 검증 코드가 길어지고 복잡해진다.  
테스트 대상과 모의 객체 간의 상호 작용이 조금만 바뀌어도 테스트가 깨지기 쉽다.

특히 DAO나 레포지토리와 같이 저장소에 대한 대역은 모의 객체를 사용하는 것보다 메모리를 이용한 가짜 구현을 사용하는 것이 테스트 코드 관리에 유리하다.